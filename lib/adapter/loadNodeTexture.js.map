{"version":3,"file":"loadNodeTexture.js","sources":["../../src/adapter/loadNodeTexture.ts"],"sourcesContent":["import canvasModule from 'canvas';\r\nimport { extensions, ExtensionType, settings, Texture, TextureSource, utils } from '@pixi/core';\r\nimport { NodeCanvasElement } from './NodeCanvasElement';\r\n\r\nimport type { LoaderParser, ResolvedAsset } from '@pixi/assets';\r\n\r\nconst { loadImage } = canvasModule;\r\nconst validImages = ['.jpg', '.png', '.jpeg', '.svg'];\r\n\r\n/** loads our textures into a node canvas */\r\nexport const loadNodeTexture = {\r\n    extension: ExtensionType.LoadParser,\r\n\r\n    test(url: string): boolean\r\n    {\r\n        return validImages.includes(utils.path.extname(url).toLowerCase());\r\n    },\r\n\r\n    async load(url: string, asset: ResolvedAsset): Promise<Texture>\r\n    {\r\n        const data = await settings.ADAPTER.fetch(url);\r\n        const image = await loadImage(Buffer.from(await data.arrayBuffer()));\r\n        const canvas = new NodeCanvasElement(image.width, image.height);\r\n        const ctx = canvas.getContext('2d');\r\n\r\n        ctx?.drawImage(image as unknown as CanvasImageSource, 0, 0);\r\n        const texture = Texture.from(canvas as unknown as TextureSource, {\r\n            resolution: utils.getResolutionOfUrl(url),\r\n            ...asset.data\r\n        });\r\n\r\n        return texture;\r\n    },\r\n\r\n    unload(texture: Texture): void\r\n    {\r\n        texture.destroy(true);\r\n    }\r\n} as LoaderParser<Texture>;\r\n\r\nextensions.add(loadNodeTexture);\r\n"],"names":["ExtensionType","utils","settings","NodeCanvasElement","Texture","extensions"],"mappings":";;;;;;AAMA,MAAM,EAAE,WAAc,GAAA,YAAA,CAAA;AACtB,MAAM,WAAc,GAAA,CAAC,MAAQ,EAAA,MAAA,EAAQ,SAAS,MAAM,CAAA,CAAA;AAG7C,MAAM,eAAkB,GAAA;AAAA,EAC3B,WAAWA,kBAAc,CAAA,UAAA;AAAA,EAEzB,KAAK,GACL,EAAA;AACI,IAAO,OAAA,WAAA,CAAY,SAASC,UAAM,CAAA,IAAA,CAAK,QAAQ,GAAG,CAAA,CAAE,aAAa,CAAA,CAAA;AAAA,GACrE;AAAA,EAEA,MAAM,IAAK,CAAA,GAAA,EAAa,KACxB,EAAA;AACI,IAAA,MAAM,IAAO,GAAA,MAAMC,aAAS,CAAA,OAAA,CAAQ,MAAM,GAAG,CAAA,CAAA;AAC7C,IAAM,MAAA,KAAA,GAAQ,MAAM,SAAU,CAAA,MAAA,CAAO,KAAK,MAAM,IAAA,CAAK,WAAY,EAAC,CAAC,CAAA,CAAA;AACnE,IAAA,MAAM,SAAS,IAAIC,mCAAA,CAAkB,KAAM,CAAA,KAAA,EAAO,MAAM,MAAM,CAAA,CAAA;AAC9D,IAAM,MAAA,GAAA,GAAM,MAAO,CAAA,UAAA,CAAW,IAAI,CAAA,CAAA;AAElC,IAAK,GAAA,EAAA,SAAA,CAAU,KAAuC,EAAA,CAAA,EAAG,CAAC,CAAA,CAAA;AAC1D,IAAM,MAAA,OAAA,GAAUC,YAAQ,CAAA,IAAA,CAAK,MAAoC,EAAA;AAAA,MAC7D,UAAA,EAAYH,UAAM,CAAA,kBAAA,CAAmB,GAAG,CAAA;AAAA,MACxC,GAAG,KAAM,CAAA,IAAA;AAAA,KACZ,CAAA,CAAA;AAED,IAAO,OAAA,OAAA,CAAA;AAAA,GACX;AAAA,EAEA,OAAO,OACP,EAAA;AACI,IAAA,OAAA,CAAQ,QAAQ,IAAI,CAAA,CAAA;AAAA,GACxB;AACJ,EAAA;AAEAI,eAAA,CAAW,IAAI,eAAe,CAAA;;;;"}